// 1. Setup the Map with a clean national view
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:3,
            maxBounds: [[24.39, -124.84], [49.38, -66.93]] 
        }).setView([39.8283, -98.5795], 4);

        // 2. Put every single cluster layer into one group
        var clusterGroup = L.layerGroup([
            cluster_AlabamaSites_3, cluster_WashingtonSites_4, cluster_WestVirginiaSites_5, 
            cluster_WisconsinSites_6, cluster_WyomingSites_7, cluster_AlabamaSites_8, 
            cluster_ArkansasSites_9, cluster_ColoradoSites_10, cluster_ConnecticutSites_11, 
            cluster_DelawareSites_12, cluster_FloridaSites_13, cluster_GeorgiaSites_14, 
            cluster_IdahoSites_15, cluster_CaliforniaSites_16, cluster_IllinoisSites_17, 
            cluster_IndianaSites_18, cluster_IowaSites_19, cluster_KansasSites_20, 
            cluster_KentuckySites_21, cluster_LouisianaSites_22, cluster_MaineSites_23, 
            cluster_MarylandSites_24, cluster_MichiganSites_25, cluster_MinnesotaSites_26, 
            cluster_MississippiSites_27, cluster_MissouriSites_28, cluster_MontanaSites_29, 
            cluster_NebraskaSites_30, cluster_NewJerseySites_31, cluster_NewMexicoSites_32, 
            cluster_NewYorkSites_33, cluster_NorthCarolinaSites_34, cluster_NorthDakotaSites_35, 
            cluster_OhioSites_36, cluster_OklahomaSites_37, cluster_OregonSites_38, 
            cluster_PennsylvaniaSites_39, cluster_SouthCarolinaSites_40, cluster_TennesseeSites_41, 
            cluster_TexasSites_42, cluster_UtahSites_43, cluster_VirginiaSites_44
        ]);

        // 3. The "Master Switch" Function
        function updateMapDisplay() {
            var zoom = map.getZoom();
            
            // Remove everything first to prevent the overlap you're seeing
            map.removeLayer(clusterGroup);
            map.removeLayer(layer_HistoricSites2025_for_QGIS_2);

            // Now add back ONLY what we want based on zoom
            if (zoom >= 6) {
                // Zoomed in: Show only the technical teal dots
                layer_HistoricSites2025_for_QGIS_2.addTo(map);
            } else {
                // Zoomed out: Show only the national cluster numbers
                clusterGroup.addTo(map);
            }
        }

        // 4. Trigger the switch whenever the user zooms
        map.on('zoomend', updateMapDisplay);
        
        // 5. Run it once immediately so the page loads correctly
        updateMapDisplay();

        // 6. Load Background Satellite Imagery
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Esri',
            maxZoom: 18
        }).addTo(map);

        // Standard Label Handling (States names)
        layer_cb_2024_us_state_500k_1.eachLayer(function(layer) {
            layer.bindTooltip('<div style="color: #000; font-size: 8pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['NAME'] + '</div>', 
            {permanent: true, offset: [0, -16], className: 'css_cb_2024_us_state_500k_1'}).addTo(map);
        });
