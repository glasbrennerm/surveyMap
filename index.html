<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/MarkerCluster.css">
        <link rel="stylesheet" href="css/MarkerCluster.Default.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
            html, body, #map { width: 100%; height: 100%; padding: 0; margin: 0; background: #fff; }
        </style>
        <title>Geomorphic Solutions Survey Portfolio</title>
    </head>
    <body>
        <div id="map"></div>

        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/leaflet.markercluster.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/labels.js"></script>

        <script src="data/cb_2024_us_state_500k_1.js"></script>
        <script src="data/HistoricSites2025_for_QGIS_2.js"></script>
        <script src="data/AlabamaSites_3.js"></script>
        <script src="data/WashingtonSites_4.js"></script>
        <script src="data/WestVirginiaSites_5.js"></script>
        <script src="data/WisconsinSites_6.js"></script>
        <script src="data/WyomingSites_7.js"></script>
        <script src="data/AlabamaSites_8.js"></script>
        <script src="data/ArkansasSites_9.js"></script>
        <script src="data/ColoradoSites_10.js"></script>
        <script src="data/ConnecticutSites_11.js"></script>
        <script src="data/DelawareSites_12.js"></script>
        <script src="data/FloridaSites_13.js"></script>
        <script src="data/GeorgiaSites_14.js"></script>
        <script src="data/IdahoSites_15.js"></script>
        <script src="data/CaliforniaSites_16.js"></script>
        <script src="data/IllinoisSites_17.js"></script>
        <script src="data/IndianaSites_18.js"></script>
        <script src="data/IowaSites_19.js"></script>
        <script src="data/KansasSites_20.js"></script>
        <script src="data/KentuckySites_21.js"></script>
        <script src="data/LouisianaSites_22.js"></script>
        <script src="data/MaineSites_23.js"></script>
        <script src="data/MarylandSites_24.js"></script>
        <script src="data/MichiganSites_25.js"></script>
        <script src="data/MinnesotaSites_26.js"></script>
        <script src="data/MississippiSites_27.js"></script>
        <script src="data/MissouriSites_28.js"></script>
        <script src="data/MontanaSites_29.js"></script>
        <script src="data/NebraskaSites_30.js"></script>
        <script src="data/NewJerseySites_31.js"></script>
        <script src="data/NewMexicoSites_32.js"></script>
        <script src="data/NewYorkSites_33.js"></script>
        <script src="data/NorthCarolinaSites_34.js"></script>
        <script src="data/NorthDakotaSites_35.js"></script>
        <script src="data/OhioSites_36.js"></script>
        <script src="data/OklahomaSites_37.js"></script>
        <script src="data/OregonSites_38.js"></script>
        <script src="data/PennsylvaniaSites_39.js"></script>
        <script src="data/SouthCarolinaSites_40.js"></script>
        <script src="data/TennesseeSites_41.js"></script>
        <script src="data/TexasSites_42.js"></script>
        <script src="data/UtahSites_43.js"></script>
        <script src="data/VirginiaSites_44.js"></script>

        <script>
            // Initialize map
            var map = L.map('map', {
                zoomControl: true, maxZoom: 28, minZoom: 3,
                maxBounds: [[24.39, -124.84], [49.38, -66.93]] 
            }).setView([39.82, -98.57], 4);

            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri', maxZoom: 18
            }).addTo(map);

            function updateVisibility() {
                var zoom = map.getZoom();
                
                // Collect only the clusters that actually loaded successfully
                var activeClusters = [];
                var clusterVars = [
                    'cluster_AlabamaSites_3', 'cluster_WashingtonSites_4', 'cluster_WestVirginiaSites_5', 
                    'cluster_WisconsinSites_6', 'cluster_WyomingSites_7', 'cluster_AlabamaSites_8', 
                    'cluster_ArkansasSites_9', 'cluster_ColoradoSites_10', 'cluster_ConnecticutSites_11', 
                    'cluster_DelawareSites_12', 'cluster_FloridaSites_13', 'cluster_GeorgiaSites_14', 
                    'cluster_IdahoSites_15', 'cluster_CaliforniaSites_16', 'cluster_IllinoisSites_17', 
                    'cluster_IndianaSites_18', 'cluster_IowaSites_19', 'cluster_KansasSites_20', 
                    'cluster_KentuckySites_21', 'cluster_LouisianaSites_22', 'cluster_MaineSites_23', 
                    'cluster_MarylandSites_24', 'cluster_MichiganSites_25', 'cluster_MinnesotaSites_26', 
                    'cluster_MississippiSites_27', 'cluster_MissouriSites_28', 'cluster_MontanaSites_29', 
                    'cluster_NebraskaSites_30', 'cluster_NewJerseySites_31', 'cluster_NewMexicoSites_32', 
                    'cluster_NewYorkSites_33', 'cluster_NorthCarolinaSites_34', 'cluster_NorthDakotaSites_35', 
                    'cluster_OhioSites_36', 'cluster_OklahomaSites_37', 'cluster_OregonSites_38', 
                    'cluster_PennsylvaniaSites_39', 'cluster_SouthCarolinaSites_40', 'cluster_TennesseeSites_41', 
                    'cluster_TexasSites_42', 'cluster_UtahSites_43', 'cluster_VirginiaSites_44'
                ];

                clusterVars.forEach(function(v) {
                    if (window[v]) activeClusters.push(window[v]);
                });

                var clusterGroup = L.layerGroup(activeClusters);

                // WIPE CLEAN
                map.removeLayer(clusterGroup);
                if (window.layer_HistoricSites2025_for_QGIS_2) {
                    map.removeLayer(layer_HistoricSites2025_for_QGIS_2);
                }

                // SWITCH AT ZOOM 6
                if (zoom >= 6) {
                    if (window.layer_HistoricSites2025_for_QGIS_2) layer_HistoricSites2025_for_QGIS_2.addTo(map);
                } else {
                    clusterGroup.addTo(map);
                }
            }

            // Fire after scripts settle
            window.onload = function() {
                setTimeout(function() {
                    updateVisibility();
                    map.on('zoomend', updateVisibility);
                }, 1000); 
            };
        </script>
    </body>
</html>
